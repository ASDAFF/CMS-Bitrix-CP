# CMS-Bitrix-CP
# CloudPayments module for  CMS Bitrix
Установка через bitrix marketplace (скоро будет доступна)
Заходим на страничку модуля в marketplace, жмем установить, указываем url сайта, нас перебросит на сайт. После чего нужно авторизоваться под админом, и скачать и установить модуль.

### Ручная установка
Копируем архив с github. На ftp создаем папку /bitrix/modules/cloudpayments.cloudpayment

Сюда копируем все содержимое из архивной папки \cloudpayments.cloudpayment\.last_version\

Итого в папке /bitrix/modules/cloudpayments.cloudpayment должны быть следующие файлы https://yadi.sk/i/jD1DjIQj3Rb5tH

Далее переходим в раздел установки решений c marketplace в админке /bitrix/admin/partner_modules.php?lang=ru. И жмем напротив скопированного модуля https://yadi.sk/i/S1Gm9jkE3Rb6Wf установить



### Настройка модуля
Сначала нужно создать новую платежную систему. Переходим «Магазин» -> “Платежные системы» - /bitrix/admin/sale_pay_system.php?lang=ru

Жем кнопку «Добавить платежную систему»

В качестве обработчика выбираем CloudPayments (cloudpayment). Далее вводим название, описание и прочие поля заполняем по своему усмотрению. Жмем «Применить», чтобы появились настройки самой платежной системы.

Далее переходим в раздел «Настройка обработчика ПС»

Заполняем «Public ID», «Пароль для API», и выбираем «Тип схемы проведения платежей», одностадийная оплата или двухстадийная оплата. Остальные параметры заполняем на свое усмотрение.



### Двухстадийная оплата
В этом режиме оплата происходит в два этапа: авторизация платежа (блокировка суммы на карте покупателя) и подтверждение списания. Для работы модуля в этом режиме создается дополнительный статус заказ:

Cloudpayments: Авторизован— На данный статус заказ переводится при получении уведомления об авторизации оплаты.

Данный статус создается автоматически при установке модуля. Далее чтобы заказ перешел в статус «Оплачен» и сумма заказа была подтверждена, нужно зайти в нужный заказ в админке битрикса и нажать кнопку «Подтвердить оплату Cloudpayments» - https://yadi.sk/i/c4Oy1sbg3Rb7Ny.



### Отправить счет клиенту

До момента пока клиент не оплатил заказ, есть возможность отправить ему напоминание об оплате, вместе с ссылкой с hash кодом, доступной с любого ПК. Для этого нужно перейти в соответствующий заказ, и нажать кнопку – «Отправить счет клиенту» - https://yadi.sk/i/jzbuBbNf3Rb7ky. После чего на почту указанную при оформление заказа придет письмо, с ссылкой на оплату. Шаблон письма лежит в шаблонах битрикс - /bitrix/admin/message_admin.php?lang=ru и создается автоматически при установке модуля. Тип почтового события «[SEND_BILL] Отправить счет клиенту»
